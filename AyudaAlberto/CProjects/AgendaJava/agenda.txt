/*
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define FALSE 0
#define TRUE  1
#define MAX_CONTACTOS 20
#define MAX_ENTRADA   128

private int MAX_CONTACTOS

typedef struct {
    int dia;
    int mes;
    int ano;
} Fecha;

typedef struct {
    char nombre[50];
    long telefono;
    Fecha fechaNacimiento;
    char tipo;
} Contacto;

//Arrays de Contactos con información
Contacto contactos[MAX_CONTACTOS];

//Numero de contactos en la agenda
int ocupacion = 0;

/*
boolean esContrasenaValida(char *contrasena) {
    char miContrasena[] = "P@ssw0rd";

    return (strcmp(contrasena, miContrasena) == 0);
}


void deStructAJSON(Contacto c){
	int i;
    /*FILE* pfichero;
    Contacto c;
    pfichero = fopen("contactos.txt", "w");
    for (i = 0; i < ocupacion; i++) {

        c = contactos[i];
        fprintf(pfichero, "%s#%ld#%02d#%02d#%04d#%c\n", c.nombre, c.telefono,
                c.fechaNacimiento.dia,
                c.fechaNacimiento.mes,
                c.fechaNacimiento.ano,
                c.tipo);
    }
    fclose(pfichero);
    FILE* pfichero;
    pfichero=fopen("JSON.txt","a");
    fprintf(pfichero, "{\"contactos\": [");
    for(i=0;i<ocupacion;i++){
    	c=contactos[i];
    	fprintf(pfichero, "\"nombre\":\"%s\",\"telefono\":\"%ld\",\"fechaNacimiento\": {\"dia\":12,\"mes\":8,\"anho\":1980},\"tipo\":%c", c.nombre, c.telefono,
                c.fechaNacimiento.dia,
                c.fechaNacimiento.mes,
                c.fechaNacimiento.ano,
                c.tipo);
	}
	fclose(pfichero);
}


boolean esContrasenaValida(char *contrasena) {
    char miContrasena[MAX_ENTRADA];
    
    FILE *fichero;
    if( (fichero = fopen("top-secret.txt","r")) == NULL){
        printf("Error. No se ha podido leer el fichero de contrasena");
        exit (-4); //Error de lectura de fichero de contraseña
    }
    fgets(miContrasena,MAX_ENTRADA,fichero);
    fclose(fichero);
    //miContrasena[strlen(miContrasena) - 1] = '\0';
    strcpy(miContrasena,strrev(miContrasena));
  
    return (strcmp(contrasena, miContrasena) == 0);
}


boolean esTipoValido(char c) {
    return (c == 'a' || c == 'e' || c == 'f' || c == 't');
}

boolean esAnoBisiesto(int ano) {
    return (((ano % 4 == 0) && !(ano % 100) == 0) || (ano % 400) == 0);
}

boolean esFechaValida(int dia, int mes, int ano) {

    switch (mes) {
        case 1:
        case 3:
        case 5:
        case 7:
        case 8:
        case 10:
        case 12:
            if (dia >= 1 && dia <= 31) {
                return TRUE;
            } else {
                return FALSE;
            }
        case 4:
        case 6:
        case 9:
        case 11:
            if (dia >= 1 && dia <= 30) {
                return TRUE;
            } else {
                return FALSE;
            }
        case 2:
            if ((dia >= 1 && dia <= 29 && esAnoBisiesto(ano)) ||
                    (dia >= 1 && dia <= 28 && !esAnoBisiesto(ano))) {
                return TRUE;
            } else {
                return FALSE;
            }
        default:
            return FALSE;
    }
    return TRUE;
}

Fecha creaFecha(char *strFecha) {

    Fecha nueva;

    nueva.dia = nueva.mes = nueva.ano = 0;


    int dia = atoi(strtok(strFecha, "/"));
    int mes = atoi(strtok(NULL, "/"));
    int ano = atoi(strtok(NULL, "/"));

    if (esFechaValida(dia, mes, ano)) {

        nueva.dia = dia;
        nueva.mes = mes;
        nueva.ano = ano;
    }

    return nueva;
}

void nuevoContacto() {

    char entrada[1024];
    Contacto nuevo;

    //Comprobamos que la agenda no esta llena
    if (ocupacion >= MAX_CONTACTOS) {
        printf("La agenda esta llena. Lo sentimos.\n");
        return;
    }

    printf("Nombre?: ");
    fflush(stdin);
    fgets(entrada, MAX_ENTRADA, stdin);
    entrada[strlen(entrada) - 1] = '\0';
    strcpy(nuevo.nombre, entrada);

    printf("Telefono?: ");
    fflush(stdin);
    fgets(entrada, MAX_ENTRADA, stdin);
    nuevo.telefono = atol(entrada);

    Fecha nueva;
    do {
        printf("Fecha Nacimiento? (dd/mm/aaaa): ");
        fflush(stdin);
        fgets(entrada, MAX_ENTRADA, stdin);
        entrada[strlen(entrada) - 1] = '\0';
        nueva = creaFecha(entrada);
        nuevo.fechaNacimiento = nueva;
    } while (nueva.ano == 0);


    do {
        printf("Tipo Contacto? (a)migo, (e)enemigo, (f)amiliar, t(trabajo): ");
        fflush(stdin);
        fgets(entrada, MAX_ENTRADA, stdin);
        nuevo.tipo = entrada[0];
    } while (!esTipoValido(entrada[0]));

    contactos[ocupacion++] = nuevo;
}

void listarContactos() {
    int i;
    for (i = 0; i < ocupacion; i++) {

        printf("%d. %s\n", i, contactos[i].nombre);
    }
    printf("\n");
}

void borrarContacto() {
	listarContactos();

    int i, idBorrar;
    char cadena[MAX_ENTRADA];

    printf("\n");
    printf("Que contacto quieres borrar?:");
    fflush(stdin);
    fgets(cadena, MAX_CONTACTOS, stdin);
    idBorrar = atoi(cadena);

    if (idBorrar >= 0 && idBorrar < ocupacion) {
        for (i = idBorrar; i <= ocupacion - 2; i++) {
            contactos[i] = contactos[i + 1];
        }
        ocupacion--;
    } else {

        printf("No hay ningun contacto con ese Id\n");
    }
}

void detalleContacto() {
	listarContactos();

    int idBuscado;
    char cadena[128];
    Contacto buscado;

    printf("\n");
    printf("De que contacto quieres info?:");
    fflush(stdin);
    fgets(cadena, MAX_CONTACTOS, stdin);
    idBuscado = atoi(cadena);

    if (idBuscado >= 0 && idBuscado < ocupacion) {
        buscado = contactos[idBuscado];
        printf("Id: %d\n", idBuscado);
        printf("Nombre:%s\n", buscado.nombre);
        printf("Telefono:%ld\n", buscado.telefono);
        printf("Fecha Nacimiento:%02d/%02d/%04d\n",
                buscado.fechaNacimiento.dia,
                buscado.fechaNacimiento.mes,
                buscado.fechaNacimiento.ano);

        switch (buscado.tipo) {
            case 'a':
                printf("Tipo: Amigo\n");
                break;
            case 'e':
                printf("Tipo: Enemigo\n");
                break;
            case 'f':
                printf("Tipo: Familiar\n");
                break;
            case 't':
                printf("Tipo: Trabajo\n");
                break;
        }
    } else {

        printf("No hay ningun contacto con ese Id\n");
    }

}

void guardarDatos() {
    int i;
    FILE* pfichero;
    Contacto c;
    pfichero = fopen("contactos.txt", "w");
    for (i = 0; i < ocupacion; i++) {

        c = contactos[i];
        fprintf(pfichero, "%s#%ld#%02d#%02d#%04d#%c\n", c.nombre, c.telefono,
                c.fechaNacimiento.dia,
                c.fechaNacimiento.mes,
                c.fechaNacimiento.ano,
                c.tipo);
    }
    fclose(pfichero);
}

int main(int argc, char *argv[]) {
	Contacto c;
	deStructAJSON(c);
    boolean salir;
    int intentos;
    char cadena[MAX_ENTRADA];
    char opcion;

    //Pedimos y comprobamos la contraseña.
    //Después de 3 intentos fallidos se finaliza el programa
    for (intentos=0; ; intentos++) {
        printf("Contrasena?: ");
        fgets(cadena, MAX_ENTRADA, stdin);
        cadena[strlen(cadena) - 1] = '\0';
        if(esContrasenaValida(cadena)) break;
        if(intentos==2) return -1;
    }
    
    //Cargamos datos
    cargarDatos();

    //Mostramos el menu y esperamos opción hasta que se elija 5.Salir
    do {
        //Mostramos menú y pedimos opción
        printf("======= AGENDA DE CONTACTOS =======\n");
        printf("\n");
        printf("1.Nuevo contacto\n");
        printf("2.Listar contactos\n");
        printf("3.Borrar contacto\n");
        printf("4.Detalle contacto\n");
        printf("5.Salir\n");
        printf("\n");
        printf("Elige una opcion: ");

        //Esperamos opcion y actuamos en consecuencia
        fflush(stdin);
        scanf("%c", &opcion);
        salir = FALSE;
        switch (opcion) {
            case '1':
                nuevoContacto();
                break;
            case '2':
                listarContactos();
                break;
            case '3':
                borrarContacto();
                break;
            case '4':
                detalleContacto();
                break;
            case '5':
                guardarDatos();
                salir = TRUE;
                break;
            default:
                printf("Opcion no valida\n");
        }
        system("pause");
        printf("\n\n");
        system("cls");
        
        
    } while (!salir);

    printf("Bye, bye. Gracias por usar GESTION DE CONTACTOS\n");

    return 0;
}
 */

public class Prinipal {

    public static void main(String[] args) {
    boolean salir;
    int intentos;
    char cadena[MAX_ENTRADA];
    char opcion;

    //Pedimos y comprobamos la contraseña.
    //Después de 3 intentos fallidos se finaliza el programa
    for (intentos=0; ; intentos++) {
        printf("Contrasena?: ");
        fgets(cadena, MAX_ENTRADA, stdin);
        cadena[strlen(cadena) - 1] = '\0';
        if(esContrasenaValida(cadena)) break;
        if(intentos==2) return -1;
    }
    
    //Cargamos datos
    cargarDatos();

    //Mostramos el menu y esperamos opción hasta que se elija 5.Salir
    do {
        //Mostramos menú y pedimos opción
        printf("======= AGENDA DE CONTACTOS =======\n");
        printf("\n");
        printf("1.Nuevo contacto\n");
        printf("2.Listar contactos\n");
        printf("3.Borrar contacto\n");
        printf("4.Detalle contacto\n");
        printf("5.Salir\n");
        printf("\n");
        printf("Elige una opcion: ");

        //Esperamos opcion y actuamos en consecuencia
        fflush(stdin);
        scanf("%c", &opcion);
        salir = FALSE;
        switch (opcion) {
            case '1':
                nuevoContacto();
                break;
            case '2':
                listarContactos();
                break;
            case '3':
                borrarContacto();
                break;
            case '4':
                detalleContacto();
                break;
            case '5':
                guardarDatos();
                salir = TRUE;
                break;
            default:
                printf("Opcion no valida\n");
        }
        system("pause");
        printf("\n\n");
        system("cls");
        
        
    } while (!salir);

    printf("Bye, bye. Gracias por usar GESTION DE CONTACTOS\n");
    }
    
}
